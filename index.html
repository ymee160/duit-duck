<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DuitDuck 365 Challenge</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        @keyframes duckShake { 
          0%, 100% { transform: rotate(-8deg); } 
          50% { transform: rotate(8deg); } 
        }
        .duck-animate { animation: duckShake 2s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Firebase Placeholder (GitHub ç¯å¢ƒéœ€é…ç½®) ---
        // æ³¨æ„ï¼šåœ¨å®é™… GitHub Pages éƒ¨ç½²æ—¶ï¼Œè¯·æ›¿æ¢è¿™äº›å ä½ç¬¦ä¸ºä½ çš„å®é™…é…ç½®
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyC_8LfzUwDqR_2bInFAtJ8vHZQ2ym12TeY",
            authDomain: "duit-duck.firebaseapp.com",
            projectId: "duit-duck",
            storageBucket: "duit-duck.firebasestorage.app",
            messagingSenderId: "994466838734",
            appId: "1:994466838734:web:cd5625e55f0608fd7a389f",
            measurementId: "G-XGW6D4CXSW"
        };
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'duit-duck-365';

        // --- çµé­‚ç»„ä»¶ï¼šæ†¨æ†¨é¸­ ---
        const DuckIcon = ({ size = 24, gender = 'female', isAnimated = false, className = "" }) => (
          <svg 
            width={size} 
            height={size} 
            viewBox="0 0 100 100" 
            className={`inline-block origin-bottom ${isAnimated ? 'duck-animate' : ''} ${className}`}
          >
            <circle cx="50" cy="55" r="42" fill="#FFD600" />
            <circle cx="50" cy="55" r="42" fill="url(#grad)" />
            <defs>
              <radialGradient id="grad" cx="40%" cy="40%" r="60%">
                <stop offset="0%" stopColor="#FFF176" stopOpacity="0.5" />
                <stop offset="100%" stopColor="#FFD600" stopOpacity="0" />
              </radialGradient>
            </defs>
            <ellipse cx="50" cy="64" rx="16" ry="9" fill="#FF9100" stroke="#E65100" strokeWidth="1" />
            <path d="M38 64 Q50 66 62 64" stroke="#BF360C" strokeWidth="0.5" fill="none" opacity="0.4" />
            <circle cx="34" cy="46" r="4.5" fill="#212121" />
            <circle cx="66" cy="46" r="4.5" fill="#212121" />
            <circle cx="35.5" cy="44.5" r="1.5" fill="white" />
            <circle cx="67.5" cy="44.5" r="1.5" fill="white" />
            <circle cx="22" cy="58" r="6" fill="#FF80AB" opacity="0.4" />
            <circle cx="78" cy="58" r="6" fill="#FF80AB" opacity="0.4" />
            {gender === 'female' ? (
              <g transform="translate(14, 10) rotate(-10)">
                <path d="M10 18 L8.8 17.1 C3.5 12.3 0 9.1 0 5.2 C0 2.3 2.3 0 5.2 0 C6.8 0 8.4 0.7 9.5 2 C10.6 0.7 12.2 0 13.8 0 C16.7 0 19 2.3 19 5.2 C19 9.1 15.5 12.3 10.2 17.1 L10 18 Z" fill="#FF4081" />
              </g>
            ) : (
              <g transform="translate(32, 80)">
                <path d="M0 10 L14 2 L14 18 Z" fill="#5D4037" />
                <path d="M36 10 L22 2 L22 18 Z" fill="#5D4037" />
                <rect x="14" y="6" width="8" height="8" rx="1" fill="#3E2723" />
              </g>
            )}
          </svg>
        );

        const HeartIcon = ({ className = "" }) => (
          <svg viewBox="0 0 100 100" className={className} fill="none">
            <path d="M50 82 L44 76.5 C24 58.5 10 46 10 31 C10 18.5 19.5 9 32 9 C39 9 46 12.5 50 17.5 C54 12.5 61 9 68 9 C80.5 9 90 18.5 90 31 C90 46 76 58.5 56 76.5 L50 82 Z" fill="#FF4081" />
          </svg>
        );

        const SAVING_LEVELS = [
          { id: 1, target: 3340, icon: "ğŸŒ±" },
          { id: 2, target: 6680, icon: "ğŸš€" }, 
          { id: 3, target: 20039, icon: "ğŸ†" },
          { id: 4, target: 40077, icon: "ğŸ’" },
          { id: 5, target: 66795, icon: "ğŸ‘‘" }
        ];

        function App() {
          const [activeTab, setActiveTab] = useState('home'); 
          const [activeCells, setActiveCells] = useState([]);
          const [gender, setGender] = useState('female');
          const [nickname, setNickname] = useState('æ†¨æ†¨é¸­001');
          const [targetLevel, setTargetLevel] = useState(SAVING_LEVELS[0]);
          const [showShareToast, setShowShareToast] = useState(false);

          // æ­¤å¤„çœç•¥ Firebase çœŸå®é€»è¾‘ä»¥ä¿è¯ HTML å¯ä»¥åœ¨æ— é…ç½®ä¸‹é¢„è§ˆ
          // å®é™…ä½¿ç”¨æ—¶éœ€æŒ‰ Canvas æ–‡æ¡£å¯¼å…¥ Firebase æ¨¡å—

          const theme = useMemo(() => {
            return gender === 'female' 
              ? { 
                  bg: 'bg-[#FFF5F7]', card: 'bg-white', accent: 'text-[#9D174D]', 
                  bar: 'bg-[#BE123C]', lightAccent: 'bg-[#FFE4E6]', border: 'border-[#FECDD3]', 
                  btnText: 'text-white', gridInactive: 'bg-white text-[#FDA4AF] border-[#FECDD3]',
                  headerText: 'text-[#881337]', subText: 'text-[#9F1239]',
                  tabActive: 'bg-[#9D174D] text-white shadow-lg', tabInactive: 'text-[#9D174D]'
                }
              : { 
                  bg: 'bg-[#FFFBF5]', card: 'bg-white', accent: 'text-[#A0522D]', 
                  bar: 'bg-[#C68642]', lightAccent: 'bg-[#F5E6D3]', border: 'border-[#E6CCB2]', 
                  btnText: 'text-white', gridInactive: 'bg-[#FDF8F3] text-[#DDB892] border-[#EDE0D4]', 
                  headerText: 'text-[#582F0E]', subText: 'text-[#9C6644]',
                  tabActive: 'bg-[#C68642] text-white shadow-lg', tabInactive: 'text-[#9C6644]'
                };
          }, [gender]);

          const currentTotal = useMemo(() => {
            const sum = activeCells.reduce((acc, day) => acc + (day * (targetLevel.target / 66795)), 0);
            return sum.toFixed(2);
          }, [activeCells, targetLevel]);

          const progressPercent = useMemo(() => ((activeCells.length / 365) * 100).toFixed(1), [activeCells]);

          const toggleCell = (num) => {
            setActiveCells(prev => prev.includes(num) ? prev.filter(n => n !== num) : [...prev, num]);
          };

          const handleShare = () => {
            const shareText = `ğŸ¥ã€DuitDuck 365ã€‘\n${nickname} æ­£åœ¨æŒ‘æˆ˜ RM ${targetLevel.target.toLocaleString()}ï¼\nâœ¨ ç›®å‰è¿›åº¦ï¼šRM ${currentTotal}\nğŸ“… å·²åšæŒï¼š${activeCells.length} å¤©ï¼ğŸ’°`;
            const textArea = document.createElement("textarea");
            textArea.value = shareText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            setShowShareToast(true);
            setTimeout(() => setShowShareToast(false), 2000);
          };

          return (
            <div className={`max-w-md mx-auto min-h-screen ${theme.bg} pb-28 shadow-2xl border-x ${theme.border} transition-colors duration-500 overflow-x-hidden relative`}>
              {showShareToast && (
                <div className="fixed top-24 left-1/2 -translate-x-1/2 z-[110] bg-black text-white px-6 py-3 rounded-full text-[10px] font-black tracking-widest shadow-2xl">
                  å¤åˆ¶æˆåŠŸï¼ğŸ¥
                </div>
              )}

              <header className={`sticky top-0 z-40 ${theme.card} bg-opacity-95 backdrop-blur-md p-5 border-b ${theme.border} flex justify-between items-center shadow-sm`}>
                <div className="flex items-center gap-3">
                  <div className={`p-1 rounded-full ${theme.lightAccent} ring-2 ring-white shadow-sm`}>
                    <DuckIcon size={58} gender={gender} isAnimated={false} />
                  </div>
                  <div>
                    <input 
                      value={nickname}
                      onChange={(e) => setNickname(e.target.value)}
                      className={`font-black bg-transparent border-none p-0 focus:ring-0 text-xl w-32 uppercase tracking-tighter ${theme.headerText}`}
                    />
                    <div className={`text-[9px] font-black uppercase tracking-[0.2em] ${theme.subText}`}>DuitDuck Club</div>
                  </div>
                </div>
                <div className="flex gap-1.5">
                  <button onClick={handleShare} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${theme.lightAccent} shadow-sm border ${theme.border}`}>ğŸ“¤</button>
                  <button onClick={() => setGender('female')} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${gender === 'female' ? `${theme.bar} shadow-md scale-110` : `${theme.lightAccent} opacity-60`}`}>
                    <HeartIcon className="w-8 h-8" />
                  </button>
                  <button onClick={() => setGender('male')} className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${gender === 'male' ? `${theme.bar} text-white shadow-md scale-110` : `${theme.lightAccent} opacity-60`}`}>ğŸ«</button>
                </div>
              </header>

              <main className="p-4">
                <div className="space-y-6">
                    <div className={`${theme.card} rounded-[2.5rem] p-8 shadow-md border ${theme.border} relative overflow-hidden`}>
                      <div className={`absolute top-0 right-0 w-32 h-32 ${theme.lightAccent} rounded-full -mr-16 -mt-16 opacity-40 animate-pulse`}></div>
                      <div className="relative z-10 text-center space-y-6">
                        <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full ${theme.lightAccent} border ${theme.border} shadow-sm`}>
                          <span className="text-sm">{targetLevel.icon}</span>
                          <span className={`text-[10px] font-black uppercase tracking-widest ${theme.accent}`}>Target: RM {targetLevel.target.toLocaleString()}</span>
                        </div>
                        <div className="flex flex-col items-center">
                          <p className={`text-[10px] font-black uppercase tracking-[0.3em] mb-1 ${theme.subText}`}>Total Saved</p>
                          <span className={`text-6xl font-black ${theme.accent} tracking-tighter`}>RM {currentTotal}</span>
                        </div>
                        <div className="space-y-2">
                          <div className="flex justify-between items-end px-2">
                            <span className={`text-[10px] font-black uppercase ${theme.subText}`}>Progress</span>
                            <span className={`text-[10px] font-black ${theme.accent}`}>{progressPercent}%</span>
                          </div>
                          <div className={`${theme.lightAccent} h-3.5 rounded-full p-0.5 overflow-hidden shadow-inner`}>
                            <div className={`h-full ${theme.bar} rounded-full transition-all duration-1000 ease-out`} style={{ width: `${progressPercent}%` }} />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className={`${theme.card} rounded-[2.5rem] p-6 shadow-sm border ${theme.border}`}>
                      <div className="flex justify-between items-center mb-6 px-2">
                        <h3 className={`text-[10px] font-black uppercase tracking-[0.2em] ${theme.subText}`}>365 Days Grid</h3>
                        <div className="text-[8px] font-black opacity-30 uppercase tracking-widest">Tap to Save</div>
                      </div>
                      <div className="grid grid-cols-7 gap-2">
                        {Array.from({length: 365}, (_, i) => i + 1).map(num => {
                          const isChecked = activeCells.includes(num);
                          return (
                            <button 
                              key={num}
                              onClick={() => toggleCell(num)}
                              className={`aspect-square rounded-xl text-[11px] font-bold transition-all active:scale-75 shadow-sm flex items-center justify-center border ${
                                isChecked ? `${theme.bar} ${theme.btnText} border-transparent shadow-md scale-110 ring-2 ring-white` : `${theme.gridInactive} border shadow-none`
                              }`}
                            >
                              {num}
                            </button>
                          );
                        })}
                      </div>
                    </div>
                </div>
              </main>

              <nav className={`fixed bottom-0 left-0 right-0 max-w-md mx-auto z-50 p-4`}>
                <div className={`${theme.card} border ${theme.border} rounded-3xl shadow-2xl flex p-1.5 gap-2 backdrop-blur-xl bg-white/70`}>
                  <button onClick={() => setActiveTab('home')} className={`flex-1 py-4 rounded-2xl font-black text-xs uppercase tracking-widest ${activeTab === 'home' ? theme.tabActive : theme.tabInactive}`}>ğŸ—“ï¸ æŒ‘æˆ˜</button>
                  <button onClick={() => setActiveTab('rank')} className={`flex-1 py-4 rounded-2xl font-black text-xs uppercase tracking-widest ${activeTab === 'rank' ? theme.tabActive : theme.tabInactive}`}>ğŸ† æ’è¡Œ</button>
                </div>
              </nav>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
